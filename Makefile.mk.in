# $Id$
# 
#---       `hector' 0.0.0 (c) 1978 by Marcin 'Amok' Konarski      ---
#
#	Makefile - this file is integral part of `hector' project.
#
#	i.  You may not $(MAKE) any changes in Copyright information.
#	ii. You must attach Copyright information to any part of every copy
#	    of this software.
#
#Copyright:
#
# You are free to use this program as is, you can redistribute binary
# package freely but:
#  1. You cannot use any part of sources of this software.
#  2. You cannot redistribute any part of sources of this software.
#  3. No reverse engineering is allowed.
#  4. If you want redistribute binary package you cannot demand any fees
#     for this software.
#     You cannot even demand cost of the carrier (CD for example).
#  5. You cannot include it to any commercial enterprise (for example 
#     as a free add-on to payed software or payed newspaper).
# This program is distributed in the hope that it will be useful, but WITHOUT
# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
# FITNESS FOR A PARTICULAR PURPOSE. Use it at your own risk.

$(foreach DIR,$(subst /, ,$(CURDIR)), $(eval $(eval DIR_ROOT_TEST=$(DIR_ROOT_TEST)/$(DIR)) $(if $(wildcard $(DIR_ROOT_TEST)/Makefile.mk.in),export DIR_ROOT ?= $(DIR_ROOT_TEST))))
PRJNAME      = hector
VERSION      = 0
SUBVERSION   = 0
EXTRAVERSION = 0
include $(DIR_ROOT)/_aux/mk/1_basic.mk
LIBS         = hcore$(LIB_INFIX) tools$(LIB_INFIX) dbwrapper$(LIB_INFIX) hconsole$(LIB_INFIX) \
               hdata$(LIB_INFIX) \
               hconsole$(LIB_INFIX) dbwrapper$(LIB_INFIX) tools$(LIB_INFIX) hcore$(LIB_INFIX) \
               pthread
NO_UNDEFINED=$(call quotecomma,$(filter -Wl$(COMMA)--no-undefined,@EXTRA_LXXFLAGS@))
$(eval $(call NEW_TARGET,hectord,src,-DTARGET_HECTOR_DAEMON,@RDYNAMIC@ $(NO_UNDEFINED)))
$(eval $(call NEW_TARGET,hector.cgi,cgi,-DTARGET_HECTOR_CGI,$(NO_UNDEFINED)))
$(eval $(call NEW_TARGET,hectoradmin,admin,-DTARGET_HECTOR_ADMIN,$(NO_UNDEFINED)))
$(eval $(call NEW_TARGET,codestation,app/codestation,,-fPIC -shared))
DO_@DO_TARGET@=1
EXEC_NAME    = 1exec
CTAGS        = @CTAGS@
GITID        = @GITID@

include $(DIR_ROOT)/_aux/inc-helper-pre.mk

override CXXFLAGS += @EXTRA_CXXFLAGS@ @DEFS@
override LXXFLAGS += @EXTRA_LXXFLAGS@
override LXXFLAGS := $(filter-out -Wl$(COMMA)--no-undefined,$(LXXFLAGS))
START_GROUP  = @START_GROUP@
END_GROUP    = @END_GROUP@

include $(DIR_ROOT)/_aux/inc-helper-post.mk

cgi-exe:
	cd $(DIR_ROOT)/build/release ; \
	g++ $(wildcard $(DIR_ROOT)/build/release/hector.cgi/*.o) ${PREFIX}/lib/libtools.a ${PREFIX}/lib/libhcore.a -lpthread -lssl -lrt -o exec ; \
	strip exec

cgi-exe-debug:
	cd $(DIR_ROOT)/build/debug ; \
	g++ $(wildcard $(DIR_ROOT)/build/debug/hector.cgi/*.o) ${PREFIX}/lib/libtools-d.a ${PREFIX}/lib/libhcore-d.a -lpthread -lssl -lrt -o exec ; \
	strip exec

